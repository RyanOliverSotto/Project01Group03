<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Frugal Foodie</title>
    <link rel="stylesheet" href="assets/css/reset.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ"
        crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <link href="https://bootswatch.com/4/superhero/bootstrap.min.css" rel="stylesheet" type="text/css">

</head>
<style>
    .imgMeta, .dataMeta{
        float: left;
    }
</style>
<body>
    <div class="container">
        <div class="jumbotron jumbotron-fluid">
            <div class="container">
                <h1 class="display-4">Frugal Foodie</h1>
            </div>
        </div>


        <div class="form-group">
            <label class="control-label col-sm-2" for="formInput">Zip or Location</label>
            <div class="col-sm-10">
                <input type="" class="form-control" id="formInput" placeholder="Chicago">
            </div>
        </div>
        <!--End for the inputbox-->
        <div class="form-group">
            <label class="control-label col-sm-2" for="formFood">What are you craving?</label>
            <div class="col-sm-10">
                <input type="" class="form-control" id="formFood" placeholder="Pizza">
            </div>
        </div>
        <!--End for the inputbox-->
        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-2">
                <button id="submit" type="submit" data-toggle="popover" class="btn btn-primary" val="">Submit</button>
            </div>
        </div>

        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
                <label for="popularsearches">Popular Searches in Your Area</label>
                <textarea class="form-control" rows="5" id="popular searches"></textarea>
            </div>
        </div>

        <div class="searchresults">

        </div>

        <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-center">
                <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1">Previous</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#">1</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#">2</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#">3</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#">Next</a>
                </li>
            </ul>
        </nav>

    </div>
    <!-- End Container -->







    <script>
        /* Psuedocode Area
        Yvellise will be doing the front end 
        Yulin the backend 
        Jeff and Ryan will float in between both
        We will attempt to replicate the Balsalmiq landing page.
        Yulin will start the Yelp | Google Maps API keys.
        Basic HTML is the goal.*/

        //Set global variables here
        var food;
        var place;
        var debug = false;



        $("body").on("click", "#submit", function () {

            place = $("#formInput").val().trim();
            food = $("#formFood").val().trim();
            event.preventDefault();

            if (debug){
            //alert("I was clicked");
            console.log(food);
            console.log(place);
            }; //End Debug

            //var queryURL = "https://api.yelp.com/v3/businesses/search?term=" + food + "&latitude=37.786882&longitude=-122.399972"
            var queryURL = "https://api.yelp.com/v3/businesses/search?term=" + food + "&location=" + place + "&price=1";

            if (debug){
            console.log(queryURL);    
            }//End debug
            
            jQuery.ajaxPrefilter(function (options) {
                if (options.crossDomain && jQuery.support.cors) {
                    options.url = 'https://cors-anywhere.herokuapp.com/' + options.url;
                }//End if
            });//End prefilter

            $.ajax({
                url: queryURL,
                method: 'GET',
                headers: { 'Authorization': 'Bearer ' + 'yF9IjWnaqJ3yRbhJnyBvBR9Kh2zBdrdaXwQysdRAeIK5PNgfHvGuNWBqF3eBbv6eFZ2HnbtHG6jUf6CXHioS30K6SjxwpMja_dWEcC_KRgoEAxwTGI8J3vCBL8ftWnYx' }
            }).then(function (response) {
                
                // do something with response
                if (debug){console.log(response);}
                
                prependResults(response);
                
            });//End Ajax Call

        









        }); //End of submit click

    function prependResults(resp){
        console.log(resp);
        //var displayPhone;
        //var name;
        //var rating;
        //var coordinates;
        //var phone;
        //var closed;
        //var image;
        for (var i = 0; i < resp.businesses.length; i ++)
        {
            let image = resp.businesses[i].image_url;
            let name =resp.businesses[i].name;
            let displayPhone = resp.businesses[i].display_phone;
            let rating = resp.businesses[i].rating;
            let coordinates = resp.businesses[i].coordinates;
            let phone = resp.businesses[i].phone;
            let closed = resp.businesses[i].is_closed;
            
            //Create the DOM HTML elements
            let restRow = $("<row>");
            let imgDiv = $("<div>");
            let restDiv = $("<div>");
            let restImage = $("<img>");
            let p1 = $("<p>").html("Name: " + name);
            let p2 = $("<p>").html("Phone: " + phone);
            let p3 = $("<p>").html("Rating: " + rating);
            let p4 = $("<p>").html("Open: " + closed);
            let p5 = $("<p>").html("Coordinates:" + coordinates);
            restImage.attr({"src": image, "class": "col-sm-4 img-responsive"});
            restDiv.attr("class", "col-sm-3 restMeta");
            imgDiv.attr("class","imgMeta");
            imgDiv.append(restImage);
            restDiv.append(p1, p2, p3, p4, p5);
            restRow.append(imgDiv, restDiv);
            $(".searchresults").append(restRow);
            
            
        }//end for loop
    
    
    
    
    
    
    
    
    
    
    
    
    }//End preprendResults fuctions




    </script>
</body>

</html>